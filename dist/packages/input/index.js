var m=()=>({axes:{0:"MoveHorizontal",1:"MoveVertical",2:"LookHorizontal",3:"LookVertical"},buttons:{0:"X",1:"O",2:"Square",3:"Triangle",4:"L1",5:"R1",6:"L2",7:"R2",8:"Select",9:"Start",10:"LeftStick",11:"RightStick",12:"AnalogUp",13:"AnalogDown",14:"AnalogLeft",15:"AnalogRight",16:"Dashboard",17:"Touchpad"}});var k=()=>m(),K=()=>({axes:{0:"MoveHorizontal",1:"MoveVertical",2:"LookHorizontal",3:"LookVertical"},buttons:{0:"A",1:"B",2:"X",3:"Y",4:"LB",5:"RB",6:"LT",7:"RT",8:"Back",9:"Start",10:"LeftStick",11:"RightStick",12:"AnalogUp",13:"AnalogDown",14:"AnalogLeft",15:"AnalogRight",16:"Guide",17:"Touchpad"}});var a={},o={axes:{0:0,1:0,2:0,3:0},buttons:{}},r={},v=.055,u=e=>Math.abs(e)>=v?e:Math.abs(e)<v?0:1,M=()=>{for(let e of navigator.getGamepads()){o[e.index]={axes:{0:u(e.axes[0]),1:u(e.axes[1]),2:u(e.axes[2]),3:u(e.axes[3])},buttons:{}};for(let[t,n]of Object.entries(e.buttons))o[e.index].buttons[t]={pressed:n.pressed,touched:n.touched,value:n.value,justPressed:n.pressed&&!r?.[e.index]?.buttons?.[t]?.pressed&&!r?.[e.index]?.buttons?.[t]?.justPressed,justReleased:!n.pressed&&r?.[e.index]?.buttons?.[t]?.pressed};for(let[t,n]of Object.entries(o[e.index]?.buttons))r[e.index].buttons[t]={...n,justPressed:!1}}},w=()=>({gamepad(e){return a[e]||Z(navigator.getGamepads()[e]),{useMapping:t=>a[e]=t(),getButton(t){if(!o[e])return{pressed:!1,touched:!1,value:0,justPressed:!1,justReleased:!1};let n=Object.keys(a[e].buttons)[Object.values(a[e].buttons).indexOf(t)];return o[e].buttons[n]?o[e].buttons[n]:{pressed:!1,touched:!1,value:0,justPressed:!1,justReleased:!1}},getAxis(t){if(!o[e])return 0;let n=Object.keys(a[e].axes)[Object.values(a[e].axes).indexOf(t)];return o[e].axes[n]?o[e].axes[n]:0}}}}),Z=e=>{if(!e)return;let t=e.id.toLowerCase(),S=[{ids:["sony","playstation"],mapping:k},{ids:["xbox"],mapping:K},{ids:["scuf"],mapping:m}].find(z=>z.ids.some(J=>t.includes(J)));S?a[e.index]=S.mapping():(console.warn(`couldn't reasonably find a mapping for controller with id ${e.id} - defaulting to xbox mapping.`),a[e.index]=K())},_=e=>{o[e]={axes:{},buttons:{}},r[e]={axes:{},buttons:{}}},ee=[],te=[];var D=e=>{ee.forEach(t=>t(e)),_(e.gamepad.index)},h=e=>{te.forEach(t=>t(e)),delete o[e.gamepad.index],delete r[e.gamepad.index]};var L=()=>({["KeyW"]:"Forward",["KeyA"]:"Left",["KeyS"]:"Back",["KeyD"]:"Right",["KeyQ"]:"Quickswitch",["KeyE"]:"Use",["KeyR"]:"Reload",["KeyY"]:"ChatAll",["KeyU"]:"ChatTeam",["Tab"]:"Scoreboard",["ControlLeft"]:"Crouch",["Space"]:"Jump",["ShiftLeft"]:"Sprint"});var p=L(),d={keys:{}},g={keys:{}},N={keys:{}},E=()=>({keyboard:{useMapping:e=>{p=e(),b()},getKey(e){let t=Object.keys(p)[Object.values(p).indexOf(e)];return t?d.keys[t]:d.keys[e]?d.keys[e]:{pressed:!1,justPressed:!1,justReleased:!1}}}}),j=()=>{for(let[e,t]of Object.entries(g.keys))d.keys[e]={...t,justReleased:!t.pressed&&N.keys?.[e]?.pressed},N.keys[e]={...t,justPressed:!1},g.keys[e]={...t,justPressed:!1}},b=()=>{for(let e of Object.keys(p))d.keys[e]={pressed:!1,justPressed:!1,justReleased:!1}},F=e=>{e.repeat||(g.keys[e.code]={pressed:!0,justPressed:!0,justReleased:!1})},A=e=>{g.keys[e.code]={pressed:!1,justPressed:!1,justReleased:!0}};var R=()=>({axes:{0:"Horizontal",1:"Vertical",2:"Wheel"},buttons:{0:"Mouse1",1:"Mouse3",2:"Mouse2",3:"Mouse4",4:"Mouse5"}});var i=R(),B=null,s={axes:{},buttons:{},position:[0,0]},c={buttons:{}},P={buttons:{}},C=()=>{for(let[e,t]of Object.entries(c.buttons))s.buttons[e]={...t,justReleased:!t.pressed&&P.buttons?.[e]?.pressed},P.buttons[e]={...t,justPressed:!1},c.buttons[e]={...t,justPressed:!1}},y={},l={},G=()=>({mouse:{useMapping:e=>{i=e(),y={},l={},f()},getButton(e){if(y[e])return s.buttons[y[e]];let t=Object.keys(i.buttons)[Object.values(i.buttons).indexOf(e)];return t?(y[e]=t,s.buttons[t]):s.buttons[e]?s.buttons[e]:{pressed:!1,justPressed:!1,justReleased:!1}},getAxis(e){if(l[e])return s.axes[l[e]];let t=Object.keys(i.axes)[Object.values(i.axes).indexOf(e)];return t?(l[e]=t,s.axes[t]):s.axes[e]?s.axes[e]:0},getPosition(){return s.position}}}),f=()=>{s.axes={0:0,1:0,2:0};for(let e of Object.keys(i.buttons))s.buttons[e]={pressed:!1,justPressed:!1,justReleased:!1}};var O=e=>{clearTimeout(B),B=setTimeout(()=>{s.axes[0]=0,s.axes[1]=0,s.axes[2]=0},30),s.axes[0]=e.movementX,s.axes[1]=e.movementY,s.position[0]=e.clientX,s.position[1]=e.clientY},T=e=>{c.buttons[e.button]={pressed:!0,justPressed:!0,justReleased:!1}},U=e=>{c.buttons[e.button]={pressed:!1,justPressed:!1,justReleased:!0}},I=e=>{s.axes[2]=e.deltaY,globalThis.requestAnimationFrame&&requestAnimationFrame(()=>{s.axes[2]=0})};var H=null,$=null,q=null,V=null,X=null,Q=null,W=null,Y=null,x=!1,se=()=>{b(),f()},De=e=>(typeof window>"u"||(x||(ne(),se(),x=!0),C(),j(),M()),e),he=()=>{oe(),x=!1},ne=()=>{H=window.addEventListener("mousemove",O),$=window.addEventListener("mousedown",T),q=window.addEventListener("mouseup",U),V=window.addEventListener("mousewheel",I),X=window.addEventListener("keydown",F),Q=window.addEventListener("keyup",A),W=window.addEventListener("gamepadconnected",D),Y=window.addEventListener("gamepaddisconnected",h)},oe=()=>{window.removeEventListener("mousemove",H),window.removeEventListener("mousedown",$),window.removeEventListener("mouseup",q),window.removeEventListener("mousewheel",V),window.removeEventListener("keydown",X),window.removeEventListener("keyup",Q),window.removeEventListener("gamepadconnected",W),window.removeEventListener("gamepaddisconnected",Y)},ae={...E()},re={...G()},ie={...w()},Le={keyboard:ae,mouse:re,gamepad:ie};export{he as destroyInput,ie as gamepad,Le as input,De as inputSystem,ae as keyboard,re as mouse};
