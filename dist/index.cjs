var ne=Object.defineProperty;var Ze=Object.getOwnPropertyDescriptor;var et=Object.getOwnPropertyNames;var tt=Object.prototype.hasOwnProperty;var nt=(e,n)=>{for(var a in n)ne(e,a,{get:n[a],enumerable:!0})},st=(e,n,a,u)=>{if(n&&typeof n=="object"||typeof n=="function")for(let f of et(n))!tt.call(e,f)&&f!==a&&ne(e,f,{get:()=>n[f],enumerable:!(u=Ze(n,f))||u.enumerable});return e};var ot=e=>st(ne({},"__esModule",{value:!0}),e);var St={};nt(St,{KeyboardKey:()=>re,MouseButton:()=>ie,PlayStation4:()=>ye,PlayStation5:()=>H,SCUFVantage2:()=>j,StandardKeyboard:()=>_,StandardMouse:()=>z,Xbox:()=>$,create2D:()=>ue,createCanvas:()=>W,createDraw:()=>U,createLogSystem:()=>Ue,createWorld:()=>me,input:()=>Ge,inputSystem:()=>$e,onGamepadConnected:()=>xe,onGamepadDisconnected:()=>we});module.exports=ot(St);var se=[];for(let e=0;e<256;e++)se[e]=(e+256).toString(16).substring(1);function rt(e,n){let a="000000"+e;return a.substring(a.length-n)}var at=32;function ce(e){let n=e.len||16,a="",u=0,f=1679616,s=e.init+Math.ceil(f/2);function l(){return s=s<=f?s:0,s++,(s-1).toString(16)}return()=>{if(!a||u===256){for(a="",u=(1+n)/2|0;u--;)a+=se[256*Math.random()|0];a=a.substring(u=0,n)}let w=Date.now().toString(36),h=rt(l(),6),P=se[u++],ee=parseInt(P,16)%at;return`ngn${w}${h}${P}${a}${ee}`}}var ge=ce({init:0,len:4}),b=Symbol(),k=Symbol(),C=Symbol(),N=Symbol(),V=Symbol(),E=Symbol(),D=Symbol(),O=Symbol(),B=Symbol(),oe=Symbol(),me=()=>{let e={[b]:{},[k]:{},[C]:{},[V]:new Set,[E]:new Map,[N]:{},[D]:[],[oe]:null,time:{elapsed:0,elapsedScaled:0,delta:0,scale:1,fps:0},[O]:!1,[B]:[]},n=o=>{e[oe]=o},a=()=>{let o=0,r=0,i=K.bind(a),p=-1,{time:d}=e;d.delta=0,d.elapsed=0,d.elapsedScaled=0,d.fps=0,e[O]=!0;let S=null,c=null;if(typeof window<"u")S=requestAnimationFrame,c=cancelAnimationFrame;else{let m=0;S=M=>setTimeout(()=>{m+=16.67,M(m)},16.67),c=M=>{clearTimeout(M)}}function K(m){if(!e[O])return c(p);if(d.delta=m-o,d.elapsedScaled+=d.delta*.001*d.scale,d.elapsedScaled<d.elapsed)return S(i);d.elapsed+=d.delta*.001,o=m,r+=d.delta,r>100&&(d.fps=Math.ceil(1e3/d.delta),r=0),e[oe](e),p=S(i)}return p=S(i),()=>e[O]=!1},u=()=>{e[O]=!1};function f(){for(let o of e[D])o(e)}function s(...o){for(let r of o)if(typeof r=="function")e[D].push(r);else if(r.update&&typeof r.update=="function")e[D].push(r.update);else throw new Error(`Not a valid system: ${JSON.stringify(r)}`)}function l(...o){for(let r of o)if(typeof r=="function")e[D]=e[D].filter(i=>i!==r);else if(r.update&&typeof r.update=="function")e[D]=e[D].filter(i=>i!==r.update);else throw new TypeError("Parameter must be a function or an object with an update function.")}let w=(o,r)=>{if(!e[V].has(r)&&e[N][r])return e[N][r].results;let{and:i=[],or:p=[],not:d=[],tag:S=[]}=o,c=Object.values(e[C]).filter(K=>(!d.length||!d.some(m=>K.hasComponent(m)))&&(!i.length||i.every(m=>K.hasComponent(m)))&&(!p.length||p.some(m=>K.hasComponent(m)))&&(!S.length||S.some(m=>K.tag===m)));return e[N][r]={results:c.map(K=>{let m={entity:K};return K.components.forEach(M=>{m[M.__ngn__.name]=M}),m})},e[V].delete(r),e[N][r].results},h=o=>{e[V].add(o)},P=({and:o=[],or:r=[],not:i=[],tag:p=[]})=>{let d=c=>Object.prototype.hasOwnProperty.call(c,"name");if(![...o,...r,...i].every(d))throw new Error("Invalid query");let S=["and",...o.map(c=>c.name),"or",...r.map(c=>c.name),"not",...i.map(c=>c.name),"tag",...p].join("");return[...o,...r,...i].forEach(c=>{let K=e[E].get(c.name)||new Set;K.add(S),e[E].set(c.name,K)}),p.forEach(c=>{let K=`tag:${c}`,m=e[E].get(K)||new Set;m.add(S),e[E].set(K,m)}),c=>c(w({and:o,or:r,not:i,tag:p},S))};function ee(o){if(!e[C][o.id])return!1;let i=Object.keys(e[b][o.id]);return i.forEach(p=>{e[k][p]=e[k][p].filter(d=>d!==o.id)}),delete e[b][o.id],delete e[C][o.id],i.forEach(p=>{let d=e[E].get(p);d&&d.forEach(h)}),!0}function Qe(o){if(typeof o=="function")return e[B].push(o),()=>{e[B]=e[B].filter(r=>r!==o)}}function Ve(o,r,i={}){if(e[b]?.[o.id]?.[r.name]!==void 0)return o;let p=e[E].get(r.name);p&&p.forEach(h);let d=r();return d.onAttach&&typeof d.onAttach=="function"&&d.onAttach(o),o.components.push(Object.assign({},{...d,...i,__ngn__:{parent:o.id,name:r.name}})),e[b][o.id]=e[b][o.id]||{},e[b][o.id][r.name]=o.components.length-1,e[k][r.name]=e[k][r.name]||[],e[k][r.name].push(o.id),o}function He(o={},r=void 0){let i=r??ge(),p=[],d=g=>`tag:${g}`;function S(g){let x=e[E].get(g);x&&x.forEach(h)}function c(g){let x=d(this.tag);return this.tag=g,S(d(g)),S(x),this}function K(){let g=d(this.tag);return this.tag="",S(g),this}function m(){return this.tag}function M(g,x={}){return Ve(this,g,x)}function qe(g){return e[b]?.[i]?.[g.name]!==void 0}function pe(g){let x=e[b][i][g.name];return p[x]}function Xe(g){let x=typeof g=="string"?g:g.name,Q=pe(typeof g=="string"?{name:x}:g);Q&&Q.onDetach&&typeof Q.onDetach=="function"&&Q.onDetach(this);let le=e[E].get(x);le&&le.forEach(h),e[b][i][x]=void 0,e[k][x]=e[k][x].filter(A=>A!==i);let Ye=e[b][i][x];return p.splice(Ye,1),Object.keys(e[b][i]).forEach(A=>{e[b][i][A]>p.findIndex(Je=>Je.name===A)&&e[b][i][A]--}),this}function ze(){return ee(this)}let te=Object.assign({},o,{id:i,components:p,addTag:c,removeTag:K,getTag:m,addComponent:M,hasComponent:qe,getComponent:pe,removeComponent:Xe,destroy:ze});return r!==void 0&&e[C][r]&&Ie(r,ge()),e[C][i]=te,e[b][i]={},e[B].forEach(g=>{g(te)}),te}function Ie(o,r){let i=e[C][o];i&&(i.id=r,e[C][r]=i,delete e[C][o],e[b][r]=e[b][o],delete e[b][o])}function _e(o){return e[C][o]}return{state:e,query:P,createEntity:He,getEntity:_e,onEntityCreated:Qe,addSystem:s,removeSystem:l,start:a,stop:u,step:f,defineMain:n}};var j=()=>({axes:{0:"MoveHorizontal",1:"MoveVertical",2:"LookHorizontal",3:"LookVertical"},buttons:{0:"X",1:"O",2:"Square",3:"Triangle",4:"L1",5:"R1",6:"L2",7:"R2",8:"Select",9:"Start",10:"LeftStick",11:"RightStick",12:"AnalogUp",13:"AnalogDown",14:"AnalogLeft",15:"AnalogRight",16:"Dashboard",17:"Touchpad"}}),ye=()=>j(),H=()=>j(),$=()=>({axes:{0:"MoveHorizontal",1:"MoveVertical",2:"LookHorizontal",3:"LookVertical"},buttons:{0:"A",1:"B",2:"X",3:"Y",4:"LB",5:"RB",6:"LT",7:"RT",8:"Back",9:"Start",10:"LeftStick",11:"RightStick",12:"AnalogUp",13:"AnalogDown",14:"AnalogLeft",15:"AnalogRight",16:"Guide",17:"Touchpad"}});var L={},v={axes:{0:0,1:0,2:0,3:0},buttons:{}},R={},fe=.055,I=e=>Math.abs(e)>=fe?e:Math.abs(e)<fe?0:1,be=()=>{for(let e of navigator.getGamepads()){v[e.index]={axes:{0:I(e.axes[0]),1:I(e.axes[1]),2:I(e.axes[2]),3:I(e.axes[3])},buttons:{}};for(let[n,a]of Object.entries(e.buttons))v[e.index].buttons[n]={pressed:a.pressed,touched:a.touched,value:a.value,justPressed:a.pressed&&!R?.[e.index]?.buttons?.[n]?.pressed&&!R?.[e.index]?.buttons?.[n]?.justPressed,justReleased:!a.pressed&&R?.[e.index]?.buttons?.[n]?.pressed};for(let[n,a]of Object.entries(v[e.index]?.buttons))R[e.index].buttons[n]={...a,justPressed:!1}}},he=()=>({gamepad(e){return L[e]||it(navigator.getGamepads()[e]),{useMapping:n=>L[e]=n(),getButton(n){if(!v[e])return{pressed:!1,touched:!1,value:0,justPressed:!1,justReleased:!1};let a=Object.keys(L[e].buttons)[Object.values(L[e].buttons).indexOf(n)];return v[e].buttons[a]?v[e].buttons[a]:{pressed:!1,touched:!1,value:0,justPressed:!1,justReleased:!1}},getAxis(n){if(!v[e])return 0;let a=Object.keys(L[e].axes)[Object.values(L[e].axes).indexOf(n)];return v[e].axes[a]?v[e].axes[a]:0}}}}),it=e=>{if(!e)return;let n=e.id.toLowerCase(),u=[{ids:["sony","playstation"],mapping:H},{ids:["xbox"],mapping:$},{ids:["scuf"],mapping:j}].find(f=>f.ids.some(s=>n.includes(s)));u?L[e.index]=u.mapping():(console.warn(`couldn't reasonably find a mapping for controller with id ${e.id} - defaulting to xbox mapping.`),L[e.index]=$())},dt=e=>{v[e]={axes:{},buttons:{}},R[e]={axes:{},buttons:{}}},Ke=[],Se=[],xe=e=>{Ke.push(e)},we=e=>{Se.push(e)},ve=e=>{Ke.forEach(n=>n(e)),dt(e.gamepad.index)},Ce=e=>{Se.forEach(n=>n(e)),delete v[e.gamepad.index],delete R[e.gamepad.index]};var re=(t=>(t.KeyQ="KeyQ",t.KeyW="KeyW",t.KeyE="KeyE",t.KeyR="KeyR",t.KeyT="KeyT",t.KeyY="KeyY",t.KeyU="KeyU",t.KeyI="KeyI",t.KeyO="KeyO",t.KeyP="KeyP",t.KeyA="KeyA",t.KeyS="KeyS",t.KeyD="KeyD",t.KeyF="KeyF",t.KeyG="KeyG",t.KeyH="KeyH",t.KeyJ="KeyJ",t.KeyK="KeyK",t.KeyL="KeyL",t.KeyZ="KeyZ",t.KeyX="KeyX",t.KeyC="KeyC",t.KeyV="KeyV",t.KeyB="KeyB",t.KeyN="KeyN",t.KeyM="KeyM",t.BracketLeft="BracketLeft",t.BracketRight="BracketRight",t.Comma="Comma",t.Period="Period",t.Slash="Slash",t.Backquote="Backquote",t.Semicolon="Semicolon",t.Quote="Quote",t.Backslash="Backslash",t.IntlBackslash="IntlBackslash",t.Digit1="Digit1",t.Digit2="Digit2",t.Digit3="Digit3",t.Digit4="Digit4",t.Digit5="Digit5",t.Digit6="Digit6",t.Digit7="Digit7",t.Digit8="Digit8",t.Digit9="Digit9",t.Digit0="Digit0",t.Minus="Minus",t.Equal="Equal",t.Enter="Enter",t.Space="Space",t.NumpadDecimal="NumpadDecimal",t.Numpad0="Numpad0",t.Numpad1="Numpad1",t.Numpad2="Numpad2",t.Numpad3="Numpad3",t.Numpad4="Numpad4",t.Numpad5="Numpad5",t.Numpad6="Numpad6",t.Numpad7="Numpad7",t.Numpad8="Numpad8",t.Numpad9="Numpad9",t.NumpadDivide="NumpadDivide",t.NumpadMultiply="NumpadMultiply",t.NumpadSubtract="NumpadSubtract",t.NumpadAdd="NumpadAdd",t.NumpadEnter="NumpadEnter",t.Delete="Delete",t.End="End",t.Home="Home",t.Insert="Insert",t.PageDown="PageDown",t.PageUp="PageUp",t.ArrowDown="ArrowDown",t.ArrowLeft="ArrowLeft",t.ArrowRight="ArrowRight",t.ArrowUp="ArrowUp",t.Backspace="Backspace",t.AltLeft="AltLeft",t.AltRight="AltRight",t.CapsLock="CapsLock",t.ContextMenu="ContextMenu",t.ControlLeft="ControlLeft",t.ControlRight="ControlRight",t.ShiftLeft="ShiftLeft",t.ShiftRight="ShiftRight",t.Tab="Tab",t.Escape="Escape",t.F1="F1",t.F2="F2",t.F3="F3",t.F4="F4",t.F5="F5",t.F6="F6",t.F7="F7",t.F8="F8",t.F9="F9",t.F10="F10",t.F11="F11",t.F12="F12",t.PrintScreen="PrintScreen",t.ScrollLock="ScrollLock",t.Pause="Pause",t))(re||{}),_=()=>({["KeyW"]:"Forward",["KeyA"]:"Left",["KeyS"]:"Back",["KeyD"]:"Right",["KeyQ"]:"Quickswitch",["KeyE"]:"Use",["KeyR"]:"Reload",["KeyY"]:"ChatAll",["KeyU"]:"ChatTeam",["Tab"]:"Scoreboard",["ControlLeft"]:"Crouch",["Space"]:"Jump",["ShiftLeft"]:"Sprint"});var q=_(),G={keys:{}},X={keys:{}},Ee={keys:{}},Me=()=>({keyboard:{useMapping:e=>{q=e(),ae()},getKey(e){let n=Object.keys(q)[Object.values(q).indexOf(e)];return n?G.keys[n]:G.keys[e]?G.keys[e]:{pressed:!1,justPressed:!1,justReleased:!1}}}}),ke=()=>{for(let[e,n]of Object.entries(X.keys))G.keys[e]={...n,justReleased:!n.pressed&&Ee.keys?.[e]?.pressed},Ee.keys[e]={...n,justPressed:!1},X.keys[e]={...n,justPressed:!1}},ae=()=>{for(let e of Object.keys(q))G.keys[e]={pressed:!1,justPressed:!1,justReleased:!1}},De=e=>{e.repeat||(X.keys[e.code]={pressed:!0,justPressed:!0,justReleased:!1})},Le=e=>{X.keys[e.code]={pressed:!1,justPressed:!1,justReleased:!0}};var ie=(s=>(s.Mouse1="0",s.Mouse2="2",s.Mouse3="1",s.Mouse4="3",s.Mouse5="4",s))(ie||{}),z=()=>({axes:{0:"Horizontal",1:"Vertical",2:"Wheel"},buttons:{0:"Mouse1",1:"Mouse3",2:"Mouse2",3:"Mouse4",4:"Mouse5"}});var T=z(),je=null,y={axes:{},buttons:{},position:[0,0]},Z={buttons:{}},Re={buttons:{}},Te=()=>{for(let[e,n]of Object.entries(Z.buttons))y.buttons[e]={...n,justReleased:!n.pressed&&Re.buttons?.[e]?.pressed},Re.buttons[e]={...n,justPressed:!1},Z.buttons[e]={...n,justPressed:!1}},Y={},J={},Fe=()=>({mouse:{useMapping:e=>{T=e(),Y={},J={},de()},getButton(e){if(Y[e])return y.buttons[Y[e]];let n=Object.keys(T.buttons)[Object.values(T.buttons).indexOf(e)];return n?(Y[e]=n,y.buttons[n]):y.buttons[e]?y.buttons[e]:{pressed:!1,justPressed:!1,justReleased:!1}},getAxis(e){if(J[e])return y.axes[J[e]];let n=Object.keys(T.axes)[Object.values(T.axes).indexOf(e)];return n?(J[e]=n,y.axes[n]):y.axes[e]?y.axes[e]:0},getPosition(){return y.position}}}),de=()=>{y.axes={0:0,1:0,2:0};for(let e of Object.keys(T.buttons))y.buttons[e]={pressed:!1,justPressed:!1,justReleased:!1}};var Pe=e=>{clearTimeout(je),je=setTimeout(()=>{y.axes[0]=0,y.axes[1]=0,y.axes[2]=0},30),y.axes[0]=e.movementX,y.axes[1]=e.movementY,y.position[0]=e.clientX,y.position[1]=e.clientY},Ae=e=>{Z.buttons[e.button]={pressed:!0,justPressed:!0,justReleased:!1}},Ne=e=>{Z.buttons[e.button]={pressed:!1,justPressed:!1,justReleased:!0}},Oe=e=>{y.axes[2]=e.deltaY,globalThis.requestAnimationFrame&&requestAnimationFrame(()=>{y.axes[2]=0})};var ut=null,pt=null,lt=null,ct=null,gt=null,mt=null,yt=null,ft=null,Be=!1,bt=()=>{ae(),de()},$e=e=>(typeof window>"u"||(Be||(ht(),bt(),Be=!0),Te(),ke(),be()),e);var ht=()=>{ut=window.addEventListener("mousemove",Pe),pt=window.addEventListener("mousedown",Ae),lt=window.addEventListener("mouseup",Ne),ct=window.addEventListener("mousewheel",Oe),gt=window.addEventListener("keydown",De),mt=window.addEventListener("keyup",Le),yt=window.addEventListener("gamepadconnected",ve),ft=window.addEventListener("gamepaddisconnected",Ce)};var Ge={...Me(),...Fe(),...he()};var W=e=>{let n=document.createElement("canvas"),{target:a,fullscreen:u}=e,{body:f}=window.document;a&&u?e.target=null:!a&&!u&&(e.fullscreen=!0),u&&(Object.assign(n.style,{position:"absolute",top:"0",left:"0"}),n.width=window.innerWidth,n.height=window.innerHeight,f.appendChild(n),Object.assign(f.style,{margin:"0",padding:"0",width:"100%",height:"100%",overflow:"hidden"})),a&&(a.appendChild(n),a.style.overflow="hidden",n.width=n.offsetWidth,n.height=n.offsetHeight),n.width=n.offsetWidth,n.height=n.offsetHeight,n.style.width="100%",n.style.height="100%";let s=window.document.querySelector('meta[name="viewport"]');if(s)Object.assign(s,{content:"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"});else{let l=Object.assign(window.document.createElement("meta"),{name:"viewport",content:"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"});window.document.head.appendChild(l)}return n};var We=e=>~~(.5+e),F=e=>({x:We(e.x),y:We(e.y)}),U=e=>({text:(s,l,w="gray",h=16)=>{s=F(s),e.save(),e.fillStyle=w,e.font=`${h}px sans-serif`,e.fillText(l,s.x,s.y),e.restore()},line:(s,l,w="gray",h=1)=>{s=F(s),l=F(l),e.save(),e.beginPath(),e.moveTo(s.x,s.y),e.lineTo(l.x,l.y),e.lineWidth=h,e.stroke(),e.closePath(),e.restore()},rectangle:(s,l,w="gray",h=1)=>{s=F(s),l=F(l),e.save(),e.beginPath(),e.rect(s.x,s.y,l.x,l.y),e.lineWidth=h,e.strokeStyle=w,e.stroke(),e.closePath(),e.restore()},circle:(s,l=25,w="gray",h=1)=>{s=F(s),e.save(),e.beginPath(),e.strokeStyle=w,e.lineWidth=h,e.arc(s.x,s.y,l,0,Math.PI*2,!0),e.stroke(),e.closePath(),e.restore()}});var ue=e=>{let{width:n=800,height:a=600,fullscreen:u=!1,target:f=null}=e.canvas,s=W({width:n,height:a,fullscreen:u,target:f}),l=s.getContext("2d"),w=U(l),h=()=>{if(u){s.style.width="100%",s.style.height="100%",s.width=window.innerWidth,s.height=window.innerHeight;return}s.width=s.offsetWidth,s.height=s.offsetHeight};return window.addEventListener("resize",h),{canvas:s,context:l,draw:w,destroy:()=>{window.removeEventListener("resize",h),s.parentElement.removeChild(s)}}};var Kt=256,Ue=(e={maxLifetime:1e4})=>{let n={expiringLogs:[],allLogs:[],update(a){this.expiringLogs.length&&this.expiringLogs.forEach((u,f)=>{u.lifetime-=a.time.delta,u.lifetime<0&&this.expiringLogs.splice(f,1)})},log(a){this.expiringLogs.push({message:a,lifetime:e.maxLifetime,start:new Date}),this.allLogs.push({message:a})}};return n.update=n.update.bind(n),n.log=n.log.bind(n),n.allLogs.push=function(){return this.length>=Kt&&this.shift(),Array.prototype.push.apply(this,arguments)},n};0&&(module.exports={KeyboardKey,MouseButton,PlayStation4,PlayStation5,SCUFVantage2,StandardKeyboard,StandardMouse,Xbox,create2D,createCanvas,createDraw,createLogSystem,createWorld,input,inputSystem,onGamepadConnected,onGamepadDisconnected});
