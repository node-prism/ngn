var Q=Object.defineProperty;var Be=Object.getOwnPropertyDescriptor;var $e=Object.getOwnPropertyNames;var Ge=Object.prototype.hasOwnProperty;var We=(e,n)=>{for(var a in n)Q(e,a,{get:n[a],enumerable:!0})},Ue=(e,n,a,l)=>{if(n&&typeof n=="object"||typeof n=="function")for(let g of $e(n))!Ge.call(e,g)&&g!==a&&Q(e,g,{get:()=>n[g],enumerable:!(l=Be(n,g))||l.enumerable});return e};var Ve=e=>Ue(Q({},"__esModule",{value:!0}),e);var st={};We(st,{create2D:()=>ee,createCanvas:()=>B,createDraw:()=>$,createLogSystem:()=>je,createWorld:()=>ne,input:()=>ke,inputSystem:()=>Le});module.exports=Ve(st);var w=Symbol(),L=Symbol(),k=Symbol(),F=Symbol(),G=Symbol(),E=Symbol(),D=Symbol(),N=Symbol(),O=Symbol(),X=Symbol(),ne=()=>{let e={[w]:{},[L]:{},[k]:{},[F]:{},[E]:!0,[G]:{},[D]:[],[X]:null,time:{elapsed:0,elapsedScaled:0,delta:0,scale:1,fps:0},[N]:!1,[O]:[]},n=r=>{e[X]=r},a=()=>{let r=0,s=0,i=c.bind(a),m=-1,{time:d}=e;d.delta=0,d.elapsed=0,d.elapsedScaled=0,d.fps=0,e[N]=!0;let h=null,M=null;if(typeof window<"u")h=requestAnimationFrame,M=cancelAnimationFrame;else{let y=0;h=K=>setTimeout(()=>{y+=16.67,K(y)},16.67),M=K=>{clearTimeout(K)}}function c(y){if(!e[N])return M(m);if(d.delta=y-r,d.elapsedScaled+=d.delta*.001*d.scale,d.elapsedScaled<d.elapsed)return h(i);d.elapsed+=d.delta*.001,r=y,s+=d.delta,s>100&&(d.fps=Math.min(Math.ceil(1e3/d.delta/(1e3/60)),60),s=0),e[X](),m=h(i)}return m=h(i),()=>e[N]=!1},l=()=>{e[N]=!1},g=(...r)=>()=>{for(let s of r)s(e)},o=(...r)=>g(...r);function p(){for(let r of e[D])r(e)}function v(...r){for(let s of r)if(typeof s=="function")e[D].push(s);else if(s.update&&typeof s.update=="function")e[D].push(s.update);else throw new Error(`Not a valid system: ${JSON.stringify(s)}`)}function b(...r){for(let s of r)if(typeof s=="function")e[D]=e[D].filter(i=>i!==s);else if(s.update&&typeof s.update=="function")e[D]=e[D].filter(i=>i!==s.update);else throw new TypeError("Parameter must be a function or an object with an update function.")}let te=(r,s)=>{if(!e[E]&&e[G][s])return e[G][s];let{and:i=[],or:m=[],not:d=[],tag:h=[]}=r,M=new Set;Object.values(e[F]).forEach(y=>{let K=[];d.length&&K.push(!d.some(S=>y.hasComponent(S))),i.length&&K.push(i.every(S=>y.hasComponent(S))),m.length&&K.push(m.some(S=>y.hasComponent(S))),h.length&&K.push(h.some(S=>y.tag&&y.tag===S)),K.length&&K.every(S=>S===!0)&&M.add(y.id)});let c=[];return[...M].map(y=>c.push(e[F][y])),e[G][s]=c,e[E]=!1,c},Fe=r=>{let{and:s=[],or:i=[],not:m=[],tag:d=[]}=r,h=c=>Object.prototype.hasOwnProperty.call(c,"name");if(![...s,...i,...m].every(h))throw new Error("Invalid query");let M=["and",...s.map(c=>c.name),"or",...i.map(c=>c.name),"not",...m.map(c=>c.name),"tag",...d].join("");return c=>c(te(r,M))};function Re(r){if(!e[F][r.id])return!1;let i=[];return e[w][r.id].forEach(m=>{i.push(m)}),i.forEach(m=>{e[k][m]=e[k][m].filter(d=>d!==r.id)}),delete e[w][r.id],delete e[F][r.id],e[E]=!0,!0}function Pe(r){if(typeof r=="function")return e[O].push(r),()=>{e[O]=e[O].filter(s=>s!==r)}}function Ne(r,s,i={}){return e[E]=!0,e[w]?.[r.id]?.has(s.name)||(i&&typeof i=="object"?r.components.push(Object.assign(s(),i)):r.components.push(s()),e[w][r.id]=e[w][r.id]||new Set,e[w][r.id].add(s.name),e[L][r.id]=e[L][r.id]||{},e[L][r.id][s.name]=r.components.length-1,e[k][s.name]=e[k][s.name]||[],e[k][s.name].push(r.id)),r}let Oe=0;function Te(r={}){e[E]=!0;let s=Oe++,i=[];function m(f){return this.tag=f,e[E]=!0,this}function d(){return this.tag="",e[E]=!0,this}function h(){return this.tag}function M(f,C={}){return Ne(this,f,C)}function c(f){return e[w]?.[s]?.has(f.name)}function y(f){let C=[...e[w][s]].indexOf(f.name);return i[C]}function K(f){return e[w][s].delete(f.name),e[L][s][f.name]=void 0,e[k][f.name]=e[k][f.name].filter(C=>C!==s),i.splice([...e[w][s]].indexOf(f.name)-1,1),Object.keys(e[L][s]).forEach(C=>{e[L][s][C]>i.findIndex(Ae=>Ae.name===C)&&e[L][s][C]--}),e[E]=!0,this}function S(){return Re(this)}let q=Object.assign({},r,{id:s,components:i,addTag:m,removeTag:d,getTag:h,addComponent:M,hasComponent:c,getComponent:y,removeComponent:K,destroy:S});return e[F][s]=q,e[w][s]=new Set,e[O].forEach(f=>{f(q)}),q}return{world:e,query:Fe,createEntity:Te,onEntityCreated:Pe,addSystem:v,removeSystem:b,start:a,stop:l,step:p,pipe:o,defineMain:n}};var z=()=>({axes:{0:"MoveHorizontal",1:"MoveVertical",2:"LookHorizontal",3:"LookVertical"},buttons:{0:"X",1:"O",2:"Square",3:"Triangle",4:"L1",5:"R1",6:"L2",7:"R2",8:"Select",9:"Start",10:"LeftStick",11:"RightStick",12:"AnalogUp",13:"AnalogDown",14:"AnalogLeft",15:"AnalogRight",16:"Dashboard",17:"Touchpad"}});var se=()=>z(),Y=()=>({axes:{0:"MoveHorizontal",1:"MoveVertical",2:"LookHorizontal",3:"LookVertical"},buttons:{0:"A",1:"B",2:"X",3:"Y",4:"LB",5:"RB",6:"LT",7:"RT",8:"Back",9:"Start",10:"LeftStick",11:"RightStick",12:"AnalogUp",13:"AnalogDown",14:"AnalogLeft",15:"AnalogRight",16:"Guide",17:"Touchpad"}});var j={},x={axes:{0:0,1:0,2:0,3:0},buttons:{}};var R={},oe=.055,W=e=>Math.abs(e)>=oe?e:Math.abs(e)<oe?0:1,re=()=>{for(let e of navigator.getGamepads())if(e){x[e.index]={axes:{0:W(e.axes[0]),1:W(e.axes[1]),2:W(e.axes[2]),3:W(e.axes[3])},buttons:{}};for(let[n,a]of Object.entries(e.buttons))x[e.index].buttons[n]={pressed:a.pressed,touched:a.touched,value:a.value,justPressed:a.pressed&&!R?.[e.index]?.buttons?.[n]?.pressed&&!R?.[e.index]?.buttons?.[n]?.justPressed,justReleased:!a.pressed&&R?.[e.index]?.buttons?.[n]?.pressed};for(let[n,a]of Object.entries(x[e.index]?.buttons))R[e.index].buttons[n]={...a,justPressed:!1}}},ae=()=>({gamepad(e){return j[e]||He(navigator.getGamepads()[e]),{useMapping:n=>j[e]=n(),getButton(n){if(!x[e])return{pressed:!1,touched:!1,value:0,justPressed:!1,justReleased:!1};let a=Object.keys(j[e].buttons)[Object.values(j[e].buttons).indexOf(n)];return x[e].buttons[a]?x[e].buttons[a]:{pressed:!1,touched:!1,value:0,justPressed:!1,justReleased:!1}},getAxis(n){if(!x[e])return 0;let a=Object.keys(j[e].axes)[Object.values(j[e].axes).indexOf(n)];return x[e].axes[a]?x[e].axes[a]:0}}}}),He=e=>{if(!e)return;let n=e.id.toLowerCase(),l=[{ids:["sony","playstation"],mapping:se},{ids:["xbox"],mapping:Y},{ids:["scuf"],mapping:z}].find(g=>g.ids.some(o=>n.includes(o)));l?j[e.index]=l.mapping():(console.warn(`couldn't reasonably find a mapping for controller with id ${e.id} - defaulting to xbox mapping.`),j[e.index]=Y())},Ie=e=>{x[e]={axes:{},buttons:{}},R[e]={axes:{},buttons:{}}},ie=e=>{Ie(e.gamepad.index)},de=e=>{delete x[e.gamepad.index],delete R[e.gamepad.index]};var J=(t=>(t.KeyQ="KeyQ",t.KeyW="KeyW",t.KeyE="KeyE",t.KeyR="KeyR",t.KeyT="KeyT",t.KeyY="KeyY",t.KeyU="KeyU",t.KeyI="KeyI",t.KeyO="KeyO",t.KeyP="KeyP",t.KeyA="KeyA",t.KeyS="KeyS",t.KeyD="KeyD",t.KeyF="KeyF",t.KeyG="KeyG",t.KeyH="KeyH",t.KeyJ="KeyJ",t.KeyK="KeyK",t.KeyL="KeyL",t.KeyZ="KeyZ",t.KeyX="KeyX",t.KeyC="KeyC",t.KeyV="KeyV",t.KeyB="KeyB",t.KeyN="KeyN",t.KeyM="KeyM",t.BracketLeft="BracketLeft",t.BracketRight="BracketRight",t.Comma="Comma",t.Period="Period",t.Slash="Slash",t.Backquote="Backquote",t.Semicolon="Semicolon",t.Quote="Quote",t.Backslash="Backslash",t.IntlBackslash="IntlBackslash",t.Digit1="Digit1",t.Digit2="Digit2",t.Digit3="Digit3",t.Digit4="Digit4",t.Digit5="Digit5",t.Digit6="Digit6",t.Digit7="Digit7",t.Digit8="Digit8",t.Digit9="Digit9",t.Digit0="Digit0",t.Minus="Minus",t.Equal="Equal",t.Enter="Enter",t.Space="Space",t.NumpadDecimal="NumpadDecimal",t.Numpad0="Numpad0",t.Numpad1="Numpad1",t.Numpad2="Numpad2",t.Numpad3="Numpad3",t.Numpad4="Numpad4",t.Numpad5="Numpad5",t.Numpad6="Numpad6",t.Numpad7="Numpad7",t.Numpad8="Numpad8",t.Numpad9="Numpad9",t.NumpadDivide="NumpadDivide",t.NumpadMultiply="NumpadMultiply",t.NumpadSubtract="NumpadSubtract",t.NumpadAdd="NumpadAdd",t.NumpadEnter="NumpadEnter",t.Delete="Delete",t.End="End",t.Home="Home",t.Insert="Insert",t.PageDown="PageDown",t.PageUp="PageUp",t.ArrowDown="ArrowDown",t.ArrowLeft="ArrowLeft",t.ArrowRight="ArrowRight",t.ArrowUp="ArrowUp",t.Backspace="Backspace",t.AltLeft="AltLeft",t.AltRight="AltRight",t.CapsLock="CapsLock",t.ContextMenu="ContextMenu",t.ControlLeft="ControlLeft",t.ControlRight="ControlRight",t.ShiftLeft="ShiftLeft",t.ShiftRight="ShiftRight",t.Tab="Tab",t.Escape="Escape",t.F1="F1",t.F2="F2",t.F3="F3",t.F4="F4",t.F5="F5",t.F6="F6",t.F7="F7",t.F8="F8",t.F9="F9",t.F10="F10",t.F11="F11",t.F12="F12",t.PrintScreen="PrintScreen",t.ScrollLock="ScrollLock",t.Pause="Pause",t))(J||{}),ue=()=>({["KeyW"]:"Forward",["KeyA"]:"Left",["KeyS"]:"Back",["KeyD"]:"Right",["KeyQ"]:"Quickswitch",["KeyE"]:"Use",["KeyR"]:"Reload",["KeyY"]:"ChatAll",["KeyU"]:"ChatTeam",["Tab"]:"Scoreboard",["ControlLeft"]:"Crouch",["Space"]:"Jump",["ShiftLeft"]:"Sprint"});var Z=ue(),T={keys:{}},U={keys:{}},pe={keys:{}},le=()=>({keyboard:{useMapping:e=>Z=e(),getKey(e){let n=Object.keys(Z)[Object.values(Z).indexOf(e)];return n?T.keys[n]:T.keys[e]?T.keys[e]:{pressed:!1,justPressed:!1,justReleased:!1}}}}),ge=()=>{for(let[e,n]of Object.entries(U.keys))T.keys[e]={...n,justReleased:!n.pressed&&pe.keys?.[e]?.pressed},pe.keys[e]={...n,justPressed:!1},U.keys[e]={...n,justPressed:!1}},ce=()=>{for(let e of Object.values(J))T.keys[e]={pressed:!1,justPressed:!1,justReleased:!1}},me=e=>{e.repeat||(U.keys[e.code]={pressed:!0,justPressed:!0,justReleased:!1})},ye=e=>{U.keys[e.code]={pressed:!1,justPressed:!1,justReleased:!0}};var _=(o=>(o.Mouse1="0",o.Mouse2="2",o.Mouse3="1",o.Mouse4="3",o.Mouse5="4",o))(_||{}),fe=()=>({axes:{0:"Horizontal",1:"Vertical",2:"Wheel"},buttons:{0:"Mouse1",1:"Mouse3",2:"Mouse2",3:"Mouse4",4:"Mouse5"}});var A=fe(),be=null,u={axes:{},buttons:{},position:[0,0]},I={buttons:{}},he={buttons:{}},Ke=()=>{for(let[e,n]of Object.entries(I.buttons))u.buttons[e]={...n,justReleased:!n.pressed&&he.buttons?.[e]?.pressed},he.buttons[e]={...n,justPressed:!1},I.buttons[e]={...n,justPressed:!1}},V={},H={},we=()=>({mouse:{useMapping:e=>{A=e(),V={},H={}},getButton(e){if(V[e])return u.buttons[V[e]];let n=Object.keys(A.buttons)[Object.values(A.buttons).indexOf(e)];return n?(V[e]=n,u.buttons[n]):u.buttons[e]?u.buttons[e]:{pressed:!1,justPressed:!1,justReleased:!1}},getAxis(e){if(H[e])return u.axes[H[e]];let n=Object.keys(A.axes)[Object.values(A.axes).indexOf(e)];return n?(H[e]=n,u.axes[n]):u.axes[e]?u.axes[e]:0},getPosition(){return u.position}}}),Se=()=>{u.axes={0:0,1:0,2:0};for(let e of Object.values(_))u.buttons[e]={pressed:!1,justPressed:!1,justReleased:!1}};var xe=e=>{clearTimeout(be),be=setTimeout(()=>{u.axes[0]=0,u.axes[1]=0,u.axes[2]=0},30),u.axes[0]=e.movementX,u.axes[1]=e.movementY,u.position[0]=e.clientX,u.position[1]=e.clientY},ve=e=>{I.buttons[e.button]={pressed:!0,justPressed:!0,justReleased:!1}},Me=e=>{I.buttons[e.button]={pressed:!1,justPressed:!1,justReleased:!0}},Ce=e=>{u.axes[2]=e.deltaY,requestAnimationFrame(()=>{u.axes[2]=0})};var qe=null,Qe=null,Xe=null,ze=null,Ye=null,Je=null,Ze=null,_e=null,Ee=!1,et=()=>{ce(),Se()},Le=e=>(typeof window>"u"||(Ee||(tt(),et(),Ee=!0),Ke(),ge(),re()),e);var tt=()=>{qe=window.addEventListener("mousemove",xe),Qe=window.addEventListener("mousedown",ve),Xe=window.addEventListener("mouseup",Me),ze=window.addEventListener("mousewheel",Ce),Ye=window.addEventListener("keydown",me),Je=window.addEventListener("keyup",ye),Ze=window.addEventListener("gamepadconnected",ie),_e=window.addEventListener("gamepaddisconnected",de)};var ke={...le(),...we(),...ae()};var B=e=>{let n=document.createElement("canvas"),{target:a,fullscreen:l}=e,{body:g}=window.document;a&&l?e.target=null:!a&&!l&&(e.fullscreen=!0),l&&(Object.assign(n.style,{position:"absolute",top:"0",left:"0"}),n.width=window.innerWidth,n.height=window.innerHeight,g.appendChild(n),Object.assign(g.style,{margin:"0",padding:"0",width:"100%",height:"100%",overflow:"hidden"})),a&&(a.appendChild(n),a.style.overflow="hidden",n.width=n.offsetWidth,n.height=n.offsetHeight),n.width=n.offsetWidth,n.height=n.offsetHeight,n.style.width="100%",n.style.height="100%";let o=window.document.querySelector('meta[name="viewport"]');if(o)Object.assign(o,{content:"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"});else{let p=Object.assign(window.document.createElement("meta"),{name:"viewport",content:"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"});window.document.head.appendChild(p)}return n};var De=e=>~~(.5+e),P=e=>({x:De(e.x),y:De(e.y)}),$=e=>({text:(o,p,v="gray",b=16)=>{o=P(o),e.save(),e.fillStyle=v,e.font=`${b}px sans-serif`,e.fillText(p,o.x,o.y),e.restore()},line:(o,p,v="gray",b=1)=>{o=P(o),p=P(p),e.save(),e.beginPath(),e.moveTo(o.x,o.y),e.lineTo(p.x,p.y),e.lineWidth=b,e.stroke(),e.closePath(),e.restore()},rectangle:(o,p,v="gray",b=1)=>{o=P(o),p=P(p),e.save(),e.beginPath(),e.rect(o.x,o.y,p.x,p.y),e.lineWidth=b,e.strokeStyle=v,e.stroke(),e.closePath(),e.restore()},circle:(o,p=25,v="gray",b=1)=>{o=P(o),e.save(),e.beginPath(),e.strokeStyle=v,e.lineWidth=b,e.arc(o.x,o.y,p,0,Math.PI*2,!0),e.stroke(),e.closePath(),e.restore()}});var ee=e=>{let{width:n=800,height:a=600,fullscreen:l=!1,target:g=null}=e.canvas,o=B({width:n,height:a,fullscreen:l,target:g}),p=o.getContext("2d"),v=$(p),b=()=>{if(l){o.style.width="100%",o.style.height="100%",o.width=window.innerWidth,o.height=window.innerHeight;return}o.width=o.offsetWidth,o.height=o.offsetHeight};return window.addEventListener("resize",b),{canvas:o,context:p,draw:v,destroy:()=>{window.removeEventListener("resize",b),o.parentElement.removeChild(o)}}};var nt=256,je=(e={maxLifetime:1e4})=>{let n={expiringLogs:[],allLogs:[],update(a){this.expiringLogs.length&&this.expiringLogs.forEach((l,g)=>{l.lifetime-=a.time.delta,l.lifetime<0&&this.expiringLogs.splice(g,1)})},log(a){this.expiringLogs.push({message:a,lifetime:e.maxLifetime,start:new Date}),this.allLogs.push({message:a})}};return n.update=n.update.bind(n),n.log=n.log.bind(n),n.allLogs.push=function(){return this.length>=nt&&this.shift(),Array.prototype.push.apply(this,arguments)},n};0&&(module.exports={create2D,createCanvas,createDraw,createLogSystem,createWorld,input,inputSystem});
