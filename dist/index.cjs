var Y=Object.defineProperty;var Ve=Object.getOwnPropertyDescriptor;var He=Object.getOwnPropertyNames;var qe=Object.prototype.hasOwnProperty;var Ie=(e,t)=>{for(var r in t)Y(e,r,{get:t[r],enumerable:!0})},_e=(e,t,r,g)=>{if(t&&typeof t=="object"||typeof t=="function")for(let f of He(t))!qe.call(e,f)&&f!==r&&Y(e,f,{get:()=>t[f],enumerable:!(g=Ve(t,f))||g.enumerable});return e};var Xe=e=>_e(Y({},"__esModule",{value:!0}),e);var ut={};Ie(ut,{create2D:()=>se,createCanvas:()=>B,createDraw:()=>$,createLogSystem:()=>Re,createWorld:()=>ae,input:()=>je,inputSystem:()=>De});module.exports=Xe(ut);var y=Symbol(),C=Symbol(),x=Symbol(),U=Symbol(),Q=Symbol(),S=Symbol(),M=Symbol(),A=Symbol(),N=Symbol(),J=Symbol(),ae=()=>{let e={[y]:{},[C]:{},[x]:{},[Q]:new Set,[S]:new Map,[U]:{},[M]:[],[J]:null,time:{elapsed:0,elapsedScaled:0,delta:0,scale:1,fps:0},[A]:!1,[N]:[]},t=n=>{e[J]=n},r=()=>{let n=0,s=0,a=h.bind(r),d=-1,{time:i}=e;i.delta=0,i.elapsed=0,i.elapsedScaled=0,i.fps=0,e[A]=!0;let b=null,u=null;if(typeof window<"u")b=requestAnimationFrame,u=cancelAnimationFrame;else{let c=0;b=R=>setTimeout(()=>{c+=16.67,R(c)},16.67),u=R=>{clearTimeout(R)}}function h(c){if(!e[A])return u(d);if(i.delta=c-n,i.elapsedScaled+=i.delta*.001*i.scale,i.elapsedScaled<i.elapsed)return b(a);i.elapsed+=i.delta*.001,n=c,s+=i.delta,s>100&&(i.fps=Math.min(Math.ceil(1e3/i.delta/(1e3/60)),60),s=0),e[J](),d=b(a)}return d=b(a),()=>e[A]=!1},g=()=>{e[A]=!1},f=(...n)=>()=>{for(let s of n)s(e)},o=(...n)=>f(...n);function l(){for(let n of e[M])n(e)}function E(...n){for(let s of n)if(typeof s=="function")e[M].push(s);else if(s.update&&typeof s.update=="function")e[M].push(s.update);else throw new Error(`Not a valid system: ${JSON.stringify(s)}`)}function w(...n){for(let s of n)if(typeof s=="function")e[M]=e[M].filter(a=>a!==s);else if(s.update&&typeof s.update=="function")e[M]=e[M].filter(a=>a!==s.update);else throw new TypeError("Parameter must be a function or an object with an update function.")}let oe=(n,s)=>{if(!e[Q].has(s)&&e[U][s])return e[U][s];let{and:a=[],or:d=[],not:i=[],tag:b=[]}=n,u=Object.values(e[x]).filter(h=>(!i.length||!i.some(c=>h.hasComponent(c)))&&(!a.length||a.every(c=>h.hasComponent(c)))&&(!d.length||d.some(c=>h.hasComponent(c)))&&(!b.length||b.some(c=>h.tag===c)));return e[U][s]=u,e[Q].delete(s),u},L=n=>{e[Q].add(n)},Te=({and:n=[],or:s=[],not:a=[],tag:d=[]})=>{let i=u=>Object.prototype.hasOwnProperty.call(u,"name");if(![...n,...s,...a].every(i))throw new Error("Invalid query");let b=["and",...n.map(u=>u.name),"or",...s.map(u=>u.name),"not",...a.map(u=>u.name),"tag",...d].join("");return[...n,...s,...a].forEach(u=>{let h=e[S].get(u.name)||new Set;h.add(b),e[S].set(u.name,h)}),d.forEach(u=>{let h=`tag:${u}`,c=e[S].get(h)||new Set;c.add(b),e[S].set(h,c)}),u=>u(oe({and:n,or:s,not:a,tag:d},b))};function Pe(n){if(!e[x][n.id])return!1;let a=Object.keys(e[y][n.id]);return a.forEach(d=>{e[C][d]=e[C][d].filter(i=>i!==n.id)}),delete e[y][n.id],delete e[x][n.id],a.forEach(d=>{let i=e[S].get(d);i&&i.forEach(L)}),!0}function Ae(n){if(typeof n=="function")return e[N].push(n),()=>{e[N]=e[N].filter(s=>s!==n)}}function Ne(n,s,a={}){if(e[y]?.[n.id]?.[s.name]!==void 0)return n;let d=e[S].get(s.name);return d&&d.forEach(L),n.components.push(Object.assign({},{...s(),...a,__ngn__:{parent:n.id,name:s.name}})),e[y][n.id]=e[y][n.id]||{},e[y][n.id][s.name]=n.components.length-1,e[C][s.name]=e[C][s.name]||[],e[C][s.name].push(n.id),n}let G=0,re=()=>{for(;e[x][G];)G++;return G};function Oe(n={},s=void 0){let a=s??re(),d=[];s!==void 0&&(G=s);let i=m=>`tag:${m}`;function b(m){let K=i(this.tag);this.tag=m;let T=e[S].get(i(m));T&&T.forEach(L);let W=e[S].get(K);return W&&W.forEach(L),this}function u(){let m=i(this.tag);this.tag="";let K=e[S].get(m);return K&&K.forEach(L),this}function h(){return this.tag}function c(m,K={}){return Ne(this,m,K)}function R(m){return e[y]?.[a]?.[m.name]!==void 0}function Ge(m){let K=e[y][a][m.name];return d[K]}function We(m){let K=typeof m=="string"?m:m.name,T=e[S].get(K);T&&T.forEach(L),e[y][a][K]=void 0,e[C][K]=e[C][K].filter(P=>P!==a);let W=e[y][a][K];return d.splice(W,1),Object.keys(e[y][a]).forEach(P=>{e[y][a][P]>d.findIndex(Qe=>Qe.name===P)&&e[y][a][P]--}),this}function Ue(){return Pe(this)}let z=Object.assign({},n,{id:a,components:d,addTag:b,removeTag:u,getTag:h,addComponent:c,hasComponent:R,getComponent:Ge,removeComponent:We,destroy:Ue});return s!==void 0&&e[x][s]&&Be(s,re()),e[x][a]=z,e[y][a]={},e[N].forEach(m=>{m(z)}),z}function Be(n,s){let a=e[x][n];a&&(a.id=s,e[x][s]=a,delete e[x][n],e[y][s]=e[y][n],delete e[y][n])}function $e(n){return e[x][n]}return{world:e,query:Te,createEntity:Oe,getEntity:$e,onEntityCreated:Ae,addSystem:E,removeSystem:w,start:r,stop:g,step:l,pipe:o,defineMain:t}};var Z=()=>({axes:{0:"MoveHorizontal",1:"MoveVertical",2:"LookHorizontal",3:"LookVertical"},buttons:{0:"X",1:"O",2:"Square",3:"Triangle",4:"L1",5:"R1",6:"L2",7:"R2",8:"Select",9:"Start",10:"LeftStick",11:"RightStick",12:"AnalogUp",13:"AnalogDown",14:"AnalogLeft",15:"AnalogRight",16:"Dashboard",17:"Touchpad"}});var ie=()=>Z(),ee=()=>({axes:{0:"MoveHorizontal",1:"MoveVertical",2:"LookHorizontal",3:"LookVertical"},buttons:{0:"A",1:"B",2:"X",3:"Y",4:"LB",5:"RB",6:"LT",7:"RT",8:"Back",9:"Start",10:"LeftStick",11:"RightStick",12:"AnalogUp",13:"AnalogDown",14:"AnalogLeft",15:"AnalogRight",16:"Guide",17:"Touchpad"}});var k={},v={axes:{0:0,1:0,2:0,3:0},buttons:{}},D={},de=.055,V=e=>Math.abs(e)>=de?e:Math.abs(e)<de?0:1,ue=()=>{for(let e of navigator.getGamepads())if(e){v[e.index]={axes:{0:V(e.axes[0]),1:V(e.axes[1]),2:V(e.axes[2]),3:V(e.axes[3])},buttons:{}};for(let[t,r]of Object.entries(e.buttons))v[e.index].buttons[t]={pressed:r.pressed,touched:r.touched,value:r.value,justPressed:r.pressed&&!D?.[e.index]?.buttons?.[t]?.pressed&&!D?.[e.index]?.buttons?.[t]?.justPressed,justReleased:!r.pressed&&D?.[e.index]?.buttons?.[t]?.pressed};for(let[t,r]of Object.entries(v[e.index]?.buttons))D[e.index].buttons[t]={...r,justPressed:!1}}},pe=()=>({gamepad(e){return k[e]||ze(navigator.getGamepads()[e]),{useMapping:t=>k[e]=t(),getButton(t){if(!v[e])return{pressed:!1,touched:!1,value:0,justPressed:!1,justReleased:!1};let r=Object.keys(k[e].buttons)[Object.values(k[e].buttons).indexOf(t)];return v[e].buttons[r]?v[e].buttons[r]:{pressed:!1,touched:!1,value:0,justPressed:!1,justReleased:!1}},getAxis(t){if(!v[e])return 0;let r=Object.keys(k[e].axes)[Object.values(k[e].axes).indexOf(t)];return v[e].axes[r]?v[e].axes[r]:0}}}}),ze=e=>{if(!e)return;let t=e.id.toLowerCase(),g=[{ids:["sony","playstation"],mapping:ie},{ids:["xbox"],mapping:ee},{ids:["scuf"],mapping:Z}].find(f=>f.ids.some(o=>t.includes(o)));g?k[e.index]=g.mapping():(console.warn(`couldn't reasonably find a mapping for controller with id ${e.id} - defaulting to xbox mapping.`),k[e.index]=ee())},Ye=e=>{v[e]={axes:{},buttons:{}},D[e]={axes:{},buttons:{}}},le=e=>{Ye(e.gamepad.index)},ge=e=>{delete v[e.gamepad.index],delete D[e.gamepad.index]};var ce=()=>({["KeyW"]:"Forward",["KeyA"]:"Left",["KeyS"]:"Back",["KeyD"]:"Right",["KeyQ"]:"Quickswitch",["KeyE"]:"Use",["KeyR"]:"Reload",["KeyY"]:"ChatAll",["KeyU"]:"ChatTeam",["Tab"]:"Scoreboard",["ControlLeft"]:"Crouch",["Space"]:"Jump",["ShiftLeft"]:"Sprint"});var H=ce(),O={keys:{}},q={keys:{}},me={keys:{}},ye=()=>({keyboard:{useMapping:e=>{H=e(),te()},getKey(e){let t=Object.keys(H)[Object.values(H).indexOf(e)];return t?O.keys[t]:O.keys[e]?O.keys[e]:{pressed:!1,justPressed:!1,justReleased:!1}}}}),fe=()=>{for(let[e,t]of Object.entries(q.keys))O.keys[e]={...t,justReleased:!t.pressed&&me.keys?.[e]?.pressed},me.keys[e]={...t,justPressed:!1},q.keys[e]={...t,justPressed:!1}},te=()=>{for(let e of Object.keys(H))O.keys[e]={pressed:!1,justPressed:!1,justReleased:!1}},be=e=>{e.repeat||(q.keys[e.code]={pressed:!0,justPressed:!0,justReleased:!1})},he=e=>{q.keys[e.code]={pressed:!1,justPressed:!1,justReleased:!0}};var Ke=()=>({axes:{0:"Horizontal",1:"Vertical",2:"Wheel"},buttons:{0:"Mouse1",1:"Mouse3",2:"Mouse2",3:"Mouse4",4:"Mouse5"}});var j=Ke(),we=null,p={axes:{},buttons:{},position:[0,0]},X={buttons:{}},xe={buttons:{}},Se=()=>{for(let[e,t]of Object.entries(X.buttons))p.buttons[e]={...t,justReleased:!t.pressed&&xe.buttons?.[e]?.pressed},xe.buttons[e]={...t,justPressed:!1},X.buttons[e]={...t,justPressed:!1}},I={},_={},ve=()=>({mouse:{useMapping:e=>{j=e(),I={},_={},ne()},getButton(e){if(I[e])return p.buttons[I[e]];let t=Object.keys(j.buttons)[Object.values(j.buttons).indexOf(e)];return t?(I[e]=t,p.buttons[t]):p.buttons[e]?p.buttons[e]:{pressed:!1,justPressed:!1,justReleased:!1}},getAxis(e){if(_[e])return p.axes[_[e]];let t=Object.keys(j.axes)[Object.values(j.axes).indexOf(e)];return t?(_[e]=t,p.axes[t]):p.axes[e]?p.axes[e]:0},getPosition(){return p.position}}}),ne=()=>{p.axes={0:0,1:0,2:0};for(let e of Object.keys(j.buttons))p.buttons[e]={pressed:!1,justPressed:!1,justReleased:!1}};var Ee=e=>{clearTimeout(we),we=setTimeout(()=>{p.axes[0]=0,p.axes[1]=0,p.axes[2]=0},30),p.axes[0]=e.movementX,p.axes[1]=e.movementY,p.position[0]=e.clientX,p.position[1]=e.clientY},Ce=e=>{X.buttons[e.button]={pressed:!0,justPressed:!0,justReleased:!1}},Me=e=>{X.buttons[e.button]={pressed:!1,justPressed:!1,justReleased:!0}},ke=e=>{p.axes[2]=e.deltaY,globalThis.requestAnimationFrame&&requestAnimationFrame(()=>{p.axes[2]=0})};var Je=null,Ze=null,et=null,tt=null,nt=null,st=null,ot=null,rt=null,Le=!1,at=()=>{te(),ne()},De=e=>(typeof window>"u"||(Le||(it(),at(),Le=!0),Se(),fe(),ue()),e);var it=()=>{Je=window.addEventListener("mousemove",Ee),Ze=window.addEventListener("mousedown",Ce),et=window.addEventListener("mouseup",Me),tt=window.addEventListener("mousewheel",ke),nt=window.addEventListener("keydown",be),st=window.addEventListener("keyup",he),ot=window.addEventListener("gamepadconnected",le),rt=window.addEventListener("gamepaddisconnected",ge)};var je={...ye(),...ve(),...pe()};var B=e=>{let t=document.createElement("canvas"),{target:r,fullscreen:g}=e,{body:f}=window.document;r&&g?e.target=null:!r&&!g&&(e.fullscreen=!0),g&&(Object.assign(t.style,{position:"absolute",top:"0",left:"0"}),t.width=window.innerWidth,t.height=window.innerHeight,f.appendChild(t),Object.assign(f.style,{margin:"0",padding:"0",width:"100%",height:"100%",overflow:"hidden"})),r&&(r.appendChild(t),r.style.overflow="hidden",t.width=t.offsetWidth,t.height=t.offsetHeight),t.width=t.offsetWidth,t.height=t.offsetHeight,t.style.width="100%",t.style.height="100%";let o=window.document.querySelector('meta[name="viewport"]');if(o)Object.assign(o,{content:"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"});else{let l=Object.assign(window.document.createElement("meta"),{name:"viewport",content:"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"});window.document.head.appendChild(l)}return t};var Fe=e=>~~(.5+e),F=e=>({x:Fe(e.x),y:Fe(e.y)}),$=e=>({text:(o,l,E="gray",w=16)=>{o=F(o),e.save(),e.fillStyle=E,e.font=`${w}px sans-serif`,e.fillText(l,o.x,o.y),e.restore()},line:(o,l,E="gray",w=1)=>{o=F(o),l=F(l),e.save(),e.beginPath(),e.moveTo(o.x,o.y),e.lineTo(l.x,l.y),e.lineWidth=w,e.stroke(),e.closePath(),e.restore()},rectangle:(o,l,E="gray",w=1)=>{o=F(o),l=F(l),e.save(),e.beginPath(),e.rect(o.x,o.y,l.x,l.y),e.lineWidth=w,e.strokeStyle=E,e.stroke(),e.closePath(),e.restore()},circle:(o,l=25,E="gray",w=1)=>{o=F(o),e.save(),e.beginPath(),e.strokeStyle=E,e.lineWidth=w,e.arc(o.x,o.y,l,0,Math.PI*2,!0),e.stroke(),e.closePath(),e.restore()}});var se=e=>{let{width:t=800,height:r=600,fullscreen:g=!1,target:f=null}=e.canvas,o=B({width:t,height:r,fullscreen:g,target:f}),l=o.getContext("2d"),E=$(l),w=()=>{if(g){o.style.width="100%",o.style.height="100%",o.width=window.innerWidth,o.height=window.innerHeight;return}o.width=o.offsetWidth,o.height=o.offsetHeight};return window.addEventListener("resize",w),{canvas:o,context:l,draw:E,destroy:()=>{window.removeEventListener("resize",w),o.parentElement.removeChild(o)}}};var dt=256,Re=(e={maxLifetime:1e4})=>{let t={expiringLogs:[],allLogs:[],update(r){this.expiringLogs.length&&this.expiringLogs.forEach((g,f)=>{g.lifetime-=r.time.delta,g.lifetime<0&&this.expiringLogs.splice(f,1)})},log(r){this.expiringLogs.push({message:r,lifetime:e.maxLifetime,start:new Date}),this.allLogs.push({message:r})}};return t.update=t.update.bind(t),t.log=t.log.bind(t),t.allLogs.push=function(){return this.length>=dt&&this.shift(),Array.prototype.push.apply(this,arguments)},t};0&&(module.exports={create2D,createCanvas,createDraw,createLogSystem,createWorld,input,inputSystem});
